import{r as a,j as s}from"./index-Dhmb56CU.js";import{c as T,d as B}from"./order-CF0HguCP.js";import{A as E}from"./Alert-DIwixrTu.js";import{B as t}from"./Button-Bmeh-JtX.js";const $=()=>{const[v,k]=a.useState([]),[d,I]=a.useState(null),[b,N]=a.useState(!1),[u,g]=a.useState(""),[n,P]=a.useState("date"),[c,y]=a.useState("desc"),[i,O]=a.useState("week"),[o,S]=a.useState("orders"),[l,x]=a.useState(1),[h,A]=a.useState(1),C=10;a.useEffect(()=>{(async()=>{N(!0),g("");try{const r=await T({sortBy:n,sortOrder:c,page:l,pageSize:C});k(r.orders),A(Math.ceil(r.total/C));const w=await B(i);I(w)}catch(r){g(r instanceof Error?r.message:"获取数据失败")}finally{N(!1)}})()},[n,c,i,l]);const m=e=>{n===e?y(c==="asc"?"desc":"asc"):(P(e),y("desc")),x(1)},j=e=>{O(e)},p=(e,r)=>s.jsxs("div",{className:"stats-card",children:[s.jsx("h3",{children:e}),s.jsx("p",{children:r})]}),D=e=>s.jsxs("div",{className:"trend-item",children:[s.jsx("span",{className:"trend-date",children:e.date}),s.jsxs("span",{className:"trend-count",children:["订单: ",e.count]}),s.jsxs("span",{className:"trend-revenue",children:["收入: ¥",e.revenue]})]},e.date),f=(e,r)=>s.jsxs("div",{className:"top-user",children:[s.jsxs("span",{className:"user-rank",children:["#",r==="seller"?"卖家":"买家"," ",e.userId]}),s.jsx("span",{className:"user-name",children:e.username}),s.jsxs("span",{className:"user-orders",children:["订单数: ",e.orderCount]}),s.jsxs("span",{className:"user-total",children:[r==="seller"?"收入":"消费",": ¥",e.total]})]},e.userId);return s.jsxs("div",{className:"admin-order-container",children:[s.jsx("h1",{className:"admin-order-title",children:"订单管理系统"}),u&&s.jsx(E,{type:"error",message:u}),s.jsxs("div",{className:"admin-tabs",children:[s.jsx(t,{variant:o==="orders"?"primary":"secondary",onClick:()=>S("orders"),children:"订单列表"}),s.jsx(t,{variant:o==="stats"?"primary":"secondary",onClick:()=>S("stats"),children:"统计数据"})]}),s.jsxs("div",{className:"admin-order-controls",children:[s.jsxs("div",{className:"period-controls",children:[s.jsx("span",{children:"统计周期："}),s.jsx(t,{variant:i==="day"?"primary":"secondary",onClick:()=>j("day"),children:"日"}),s.jsx(t,{variant:i==="week"?"primary":"secondary",onClick:()=>j("week"),children:"周"}),s.jsx(t,{variant:i==="month"?"primary":"secondary",onClick:()=>j("month"),children:"月"})]}),o==="orders"&&s.jsxs("div",{className:"sort-options",children:[s.jsx("span",{children:"排序方式："}),s.jsxs(t,{variant:"text",onClick:()=>m("orderId"),className:n==="orderId"?"active":"",children:["订单ID ",n==="orderId"&&(c==="asc"?"↑":"↓")]}),s.jsxs(t,{variant:"text",onClick:()=>m("date"),className:n==="date"?"active":"",children:["时间 ",n==="date"&&(c==="asc"?"↑":"↓")]}),s.jsxs(t,{variant:"text",onClick:()=>m("price"),className:n==="price"?"active":"",children:["金额 ",n==="price"&&(c==="asc"?"↑":"↓")]})]})]}),b?s.jsx("div",{className:"loading",children:"加载中..."}):s.jsx(s.Fragment,{children:o==="orders"?s.jsx("div",{className:"admin-order-list",children:v.length===0?s.jsx("div",{className:"no-orders",children:"暂无订单"}):s.jsxs(s.Fragment,{children:[s.jsxs("table",{className:"admin-order-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"订单ID"}),s.jsx("th",{children:"盲盒名称"}),s.jsx("th",{children:"物品"}),s.jsx("th",{children:"卖家ID"}),s.jsx("th",{children:"买家ID"}),s.jsx("th",{children:"金额"}),s.jsx("th",{children:"交易时间"})]})}),s.jsx("tbody",{children:v.map(e=>s.jsxs("tr",{children:[s.jsx("td",{children:e.orderId}),s.jsx("td",{children:e.boxName}),s.jsx("td",{children:e.itemName}),s.jsx("td",{children:e.sellerId}),s.jsx("td",{children:e.buyerId}),s.jsxs("td",{children:["¥",e.price]}),s.jsx("td",{children:new Date(e.createdAt).toLocaleString()})]},e.orderId))})]}),h>1&&s.jsxs("div",{className:"pagination-controls",children:[s.jsx(t,{onClick:()=>x(e=>Math.max(1,e-1)),disabled:l===1,children:"上一页"}),s.jsxs("span",{children:["第 ",l," 页 / 共 ",h," 页"]}),s.jsx(t,{onClick:()=>x(e=>Math.min(h,e+1)),disabled:l===h,children:"下一页"})]})]})}):d&&s.jsxs("div",{className:"stats-container",children:[s.jsxs("div",{className:"stats-section",children:[p("总订单数",d.totalOrders),p("总收入",`¥${d.totalRevenue}`),p("平均订单金额",`¥${d.avgOrderValue}`)]}),s.jsxs("div",{className:"trends-section",children:[s.jsx("h3",{children:"订单趋势"}),s.jsx("div",{className:"trends-list",children:d.orderTrends.map(D)})]}),s.jsxs("div",{className:"top-section",children:[s.jsx("h3",{children:"顶级卖家"}),s.jsx("div",{className:"top-list",children:d.topSellers.map(e=>f({...e,total:e.totalRevenue},"seller"))})]}),s.jsxs("div",{className:"top-section",children:[s.jsx("h3",{children:"顶级买家"}),s.jsx("div",{className:"top-list",children:d.topBuyers.map(e=>f({...e,total:e.totalSpent},"buyer"))})]})]})})]})};export{$ as default};
