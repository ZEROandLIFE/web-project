import{r,j as e,f as D}from"./index-Dhmb56CU.js";import{g as I,a as B,b as E}from"./order-CF0HguCP.js";import{A as T}from"./Alert-DIwixrTu.js";import{B as n}from"./Button-Bmeh-JtX.js";const R=()=>{const[g,C]=r.useState([]),[O,p]=r.useState(!1),[f,v]=r.useState(""),[t,A]=r.useState("all"),[a,b]=r.useState("date"),[i,y]=r.useState("desc"),[N,k]=r.useState(null),[d,x]=r.useState(1),[l,M]=r.useState(1),j=10;r.useEffect(()=>{(async()=>{const u=await D();k(u),p(!0),v("");try{let c;t==="seller"?c=await I():t==="buyer"?c=await B():c=await E();const w=[...c.orders].sort((o,h)=>a==="date"?i==="desc"?new Date(h.createdAt).getTime()-new Date(o.createdAt).getTime():new Date(o.createdAt).getTime()-new Date(h.createdAt).getTime():i==="desc"?h.price-o.price:o.price-h.price);C(w),M(Math.ceil(w.length/j)),x(1)}catch(c){v(c instanceof Error?c.message:"获取订单失败")}finally{p(!1)}})()},[t,a,i]);const m=s=>{A(s)},S=s=>{a===s?y(i==="asc"?"desc":"asc"):(b(s),y("desc"))},P=()=>{const s=(d-1)*j,u=s+j;return g.slice(s,u)};return e.jsxs("div",{className:"order-container",children:[e.jsx("h1",{className:"order-title",children:"我的订单"}),f&&e.jsx(T,{type:"error",message:f}),e.jsxs("div",{className:"order-controls",children:[e.jsxs("div",{className:"view-mode",children:[e.jsx(n,{variant:t==="all"?"primary":"secondary",onClick:()=>m("all"),children:"全部订单"}),e.jsx(n,{variant:t==="seller"?"primary":"secondary",onClick:()=>m("seller"),children:"作为卖家"}),e.jsx(n,{variant:t==="buyer"?"primary":"secondary",onClick:()=>m("buyer"),children:"作为买家"})]}),e.jsxs("div",{className:"sort-options",children:[e.jsx("span",{children:"排序方式："}),e.jsxs(n,{variant:"text",onClick:()=>S("date"),className:a==="date"?"active":"",children:["时间 ",a==="date"&&(i==="asc"?"↑":"↓")]}),e.jsxs(n,{variant:"text",onClick:()=>S("price"),className:a==="price"?"active":"",children:["金额 ",a==="price"&&(i==="asc"?"↑":"↓")]})]})]}),O?e.jsx("div",{className:"loading",children:"加载中..."}):e.jsx("div",{className:"order-list",children:g.length===0?e.jsx("div",{className:"no-orders",children:"暂无订单"}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"order-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"订单ID"}),e.jsx("th",{children:"盲盒名称"}),e.jsx("th",{children:"获得物品"}),e.jsx("th",{children:"金额"}),e.jsx("th",{children:"交易类型"}),e.jsx("th",{children:"交易时间"})]})}),e.jsx("tbody",{children:P().map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.orderId}),e.jsx("td",{children:s.boxName}),e.jsx("td",{children:s.itemName}),e.jsxs("td",{children:["¥",s.price]}),e.jsx("td",{children:t==="all"&&N?s.sellerId===N.id?"卖出":"买入":t==="seller"?"卖出":"买入"}),e.jsx("td",{children:new Date(s.createdAt).toLocaleString()})]},s.orderId))})]}),l>1&&e.jsxs("div",{className:"pagination-controls",children:[e.jsx(n,{onClick:()=>x(s=>Math.max(1,s-1)),disabled:d===1,children:"上一页"}),e.jsxs("span",{children:["第 ",d," 页 / 共 ",l," 页"]}),e.jsx(n,{onClick:()=>x(s=>Math.min(l,s+1)),disabled:d===l,children:"下一页"})]})]})})]})};export{R as default};
