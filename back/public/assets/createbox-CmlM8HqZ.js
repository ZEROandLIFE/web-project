import{r as a,j as t,f as F,u as P}from"./index-Dhmb56CU.js";import{c as R}from"./box-Chv2p0uG.js";import{A as g}from"./Alert-DIwixrTu.js";import{B as v}from"./Button-Bmeh-JtX.js";import{I as l}from"./Input-ChJNsZGx.js";import{T}from"./Textarea-BPyxjXkS.js";const k=({onSubmit:d})=>{const[i,m]=a.useState(""),[c,b]=a.useState(""),[u,h]=a.useState(0),[p,C]=a.useState(null),[j,I]=a.useState(""),[y,w]=a.useState(0),[n,f]=a.useState([{name:"",quantity:0}]),[N,x]=a.useState(""),[S,B]=a.useState("");a.useEffect(()=>{document.title="创建盲盒 - 盲盒平台",(async()=>{try{const s=await F();B(s.id)}catch(s){console.error("获取用户信息失败:",s),x("获取用户信息失败，请重新登录")}})()},[]);const U=e=>{if(e.target.files&&e.target.files[0]){const s=e.target.files[0];C(s);const r=URL.createObjectURL(s);I(r)}},q=(e,s,r)=>{const o=[...n];o[e]={...o[e],[s]:s==="quantity"?Number(r):r},f(o)},A=()=>{f([...n,{name:"",quantity:0}])},E=e=>{if(n.length<=1)return;const s=n.filter((r,o)=>o!==e);f(s)},D=e=>{e.preventDefault();const s=n.reduce((r,o)=>r+o.quantity,0);if(u>s){x("盲盒的数量不能大于包含物品中所有物品数量总和");return}if(!i||n.some(r=>!r.name||r.quantity<=0)){x("请填写所有必填字段");return}if(!S){x("无法获取用户信息，请重新登录");return}d({boxName:i,boxDescription:c,boxNum:u,boxAvatar:p||void 0,price:y,userId:S,items:n})};return t.jsxs("form",{className:"create-box-form",onSubmit:D,children:[N&&t.jsx(g,{type:"error",message:N}),t.jsx(l,{label:"盲盒名称",id:"boxName",value:i,onChange:e=>m(e.target.value),required:!0}),t.jsx(T,{label:"盲盒描述",id:"boxDescription",value:c,onChange:e=>b(e.target.value),rows:3}),t.jsx(l,{label:"盲盒数量",id:"boxNum",type:"number",min:"1",value:u,onChange:e=>h(Number(e.target.value)),required:!0}),t.jsx(l,{label:"盲盒价格",id:"price",type:"number",min:"0",step:"0.01",value:y,onChange:e=>w(Number(e.target.value)),required:!0}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{className:"form-label",children:"盲盒封面"}),t.jsx("input",{type:"file",accept:"image/*",onChange:U,className:"form-file-input"}),j&&t.jsx("div",{className:"image-preview",children:t.jsx("img",{src:j,alt:"盲盒封面预览"})})]}),t.jsxs("div",{className:"items-section",children:[t.jsxs("h3",{className:"items-title",children:["包含物品 (总数量: ",n.reduce((e,s)=>e+s.quantity,0),")"]}),n.map((e,s)=>t.jsxs("div",{className:"item-row",children:[t.jsx(l,{label:"物品名称",id:`itemName-${s}`,value:e.name,onChange:r=>q(s,"name",r.target.value),required:!0}),t.jsx(l,{label:"物品数量",id:`itemQuantity-${s}`,type:"number",min:"1",value:e.quantity,onChange:r=>q(s,"quantity",r.target.value),required:!0}),t.jsx(v,{type:"button",variant:"text",onClick:()=>E(s),disabled:n.length<=1,children:"删除"})]},s)),t.jsx(v,{type:"button",variant:"secondary",onClick:A,children:"添加物品"})]}),t.jsx(v,{type:"submit",fullWidth:!0,children:"创建盲盒"})]})},z=()=>{const[d,i]=a.useState(!1),[m,c]=a.useState(""),b=P(),u=async h=>{try{await R(h),i(!0),c(""),setTimeout(()=>b("/home"),2e3)}catch(p){console.error(p),c("创建盲盒失败，请重试"),i(!1)}};return t.jsxs("div",{className:"create-box-container",children:[t.jsx("h1",{className:"create-box-title",children:"创建新盲盒"}),d&&t.jsx(g,{type:"success",message:"盲盒创建成功，即将跳转到首页..."}),m&&t.jsx(g,{type:"error",message:m}),t.jsx(k,{onSubmit:u})]})};export{z as default};
