import{r as o,u as N,j as e}from"./index-Dhmb56CU.js";import{g as p}from"./box-Chv2p0uG.js";const B=({onSearch:r})=>{const[i,l]=o.useState(""),n=N(),m=c=>{l(c.target.value),r(c.target.value)},d=()=>{n("/createbox")};return e.jsxs("div",{className:"home-form",children:[e.jsx("input",{type:"text",placeholder:"搜索盲盒名称...",value:i,onChange:m,className:"home-search-input"}),e.jsx("button",{onClick:d,className:"home-create-button",children:"创建盲盒"})]})},A=()=>{const[r,i]=o.useState([]),[l,n]=o.useState([]),[m,d]=o.useState(!0),[c,g]=o.useState(""),[t,h]=o.useState(null),x=N();o.useEffect(()=>{document.title="盲盒商城",(async()=>{try{const a=await p();i(a),n(a),a.length>0&&h(u(a))}catch(a){console.error("获取盲盒失败:",a),g("获取盲盒数据失败，请稍后重试")}finally{d(!1)}})()},[]);const u=s=>{const a=Math.floor(Math.random()*s.length);return s[a]};o.useEffect(()=>{if(r.length===0)return;const s=setInterval(()=>{h(u(r))},5e3);return()=>clearInterval(s)},[r]);const j=s=>{if(!s.trim()){n(r);return}const a=r.filter(b=>b.boxName.toLowerCase().includes(s.toLowerCase()));n(a)},v=s=>{x(`/boxdetail/${s}`)},f=s=>{x(`/boxdetail/${s}`)};return m?e.jsx("div",{className:"home-loading",children:"加载中..."}):c?e.jsx("div",{className:"home-error",children:c}):e.jsxs("div",{className:"home-container",children:[e.jsx("h1",{className:"home-title",children:"盲盒商城"}),e.jsx(B,{onSearch:j}),t&&e.jsx("div",{className:"home-ad-container",onClick:()=>f(t.boxId),children:e.jsxs("div",{className:"home-ad-content",children:[e.jsx("h3",{children:"热门推荐"}),e.jsxs("div",{className:"home-ad-box",children:[t.boxAvatar?e.jsx("img",{src:t.boxAvatar,alt:t.boxName,className:"home-ad-image",onError:s=>{s.target.src="/assets/no-image.png",s.target.alt="暂无图片"}}):e.jsx("div",{className:"home-ad-no-image",children:"暂无图片"}),e.jsxs("div",{className:"home-ad-info",children:[e.jsx("h4",{className:"home-ad-name",children:t.boxName}),e.jsxs("div",{className:"home-ad-details",children:[e.jsxs("span",{children:["剩余: ",t.boxNum]}),e.jsxs("span",{className:"home-ad-price",children:["¥",t.price]})]})]})]})]})}),e.jsx("div",{className:"home-boxes-grid",children:l.length>0?l.map(s=>e.jsxs("div",{className:"home-box-item",onClick:()=>v(s.boxId),children:[s.boxAvatar?e.jsx("img",{src:s.boxAvatar,alt:s.boxName,className:"home-box-image",onError:a=>{a.target.src="/assets/no-image.png",a.target.alt="暂无图片"}}):e.jsx("div",{className:"home-box-no-image",children:"暂无图片"}),e.jsx("h3",{className:"home-box-name",children:s.boxName}),e.jsxs("div",{className:"home-box-info",children:[e.jsxs("span",{className:"home-box-num",children:["数量: ",s.boxNum]}),e.jsxs("span",{className:"home-box-price",children:["¥",s.price]})]})]},s.boxId)):e.jsx("div",{className:"home-no-results",children:"没有找到匹配的盲盒"})})]})};export{A as default};
