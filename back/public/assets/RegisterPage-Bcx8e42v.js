import{r as l,u as j,j as a,a as C}from"./index-Dhmb56CU.js";import{B as x}from"./Button-Bmeh-JtX.js";import{I as u}from"./Input-ChJNsZGx.js";import{A as w}from"./Alert-DIwixrTu.js";const R=()=>{l.useEffect(()=>{document.title="用户注册 - 盲盒平台"},[]);const m=j(),p=l.useRef(null),[e,d]=l.useState({username:"",phone:"",address:"",password:"",confirmPassword:"",avatar:null,avatarPreview:null}),[h,t]=l.useState(null),[v,g]=l.useState(null),[f,c]=l.useState(!1),o=r=>{const{name:s,value:n}=r.target;if(s==="phone"){const i=n.replace(/\D/g,"");d(P=>({...P,[s]:i}));return}d(i=>({...i,[s]:n}))},b=r=>{if(r.target.files&&r.target.files[0]){const s=r.target.files[0];if(!s.type.match("image.*")){t("请上传图片文件");return}const n=new FileReader;n.onloadend=()=>{d(i=>({...i,avatar:s,avatarPreview:n.result}))},n.readAsDataURL(s)}},y=()=>{d({username:"",phone:"",address:"",password:"",confirmPassword:"",avatar:null,avatarPreview:null}),t(null),p.current&&(p.current.value="")},N=async r=>{if(r.preventDefault(),c(!0),t(null),g(null),e.password!==e.confirmPassword){t("两次输入的密码不一致"),c(!1);return}if(e.phone.length!==11){t("手机号必须是11位"),c(!1);return}try{const s=new FormData;s.append("username",e.username),s.append("phone",e.phone),s.append("address",e.address),s.append("password",e.password),e.avatar&&s.append("avatar",e.avatar),await C(e.username,e.password,e.phone,e.avatar||void 0,e.address),g("注册成功！即将跳转到登录页面..."),setTimeout(()=>{m("/login")},2e3)}catch(s){t(s instanceof Error?s.message:"注册失败")}finally{c(!1)}};return a.jsxs("form",{onSubmit:N,className:"auth-form",children:[h&&a.jsx(w,{type:"error",message:h}),v&&a.jsx(w,{type:"success",message:v}),a.jsx(u,{label:"用户名",type:"text",name:"username",value:e.username,onChange:o,required:!0}),a.jsx(u,{label:"手机号",type:"tel",name:"phone",value:e.phone,onChange:o,inputMode:"numeric",maxLength:11,required:!0}),a.jsx(u,{label:"地址",type:"text",name:"address",value:e.address,onChange:o,required:!0}),a.jsx(u,{label:"密码",type:"password",name:"password",value:e.password,onChange:o,required:!0}),a.jsx(u,{label:"确认密码",type:"password",name:"confirmPassword",value:e.confirmPassword,onChange:o,required:!0}),a.jsxs("div",{className:"input-group",children:[a.jsx("label",{className:"input-label",children:"头像"}),a.jsx("input",{type:"file",accept:"image/*",onChange:b,ref:p,className:"input-field"}),e.avatarPreview&&a.jsx("div",{className:"avatar-preview",children:a.jsx("img",{src:e.avatarPreview,alt:"头像预览",className:"avatar-image"})})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx(x,{type:"button",variant:"secondary",onClick:y,disabled:f,children:"重置"}),a.jsx(x,{type:"submit",disabled:f,children:f?"注册中...":"注册"})]})]})},A=()=>{const m=j();return a.jsx("div",{className:"auth-page",children:a.jsxs("div",{className:"register-container",children:[a.jsx("button",{className:"back-to-login",onClick:()=>m("/login"),children:"← 返回登录"}),a.jsx("h1",{className:"auth-title",children:"注册"}),a.jsx(R,{})]})})};export{A as default};
